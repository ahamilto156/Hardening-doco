<!DOCTYPE html>
<html lang="en-US" xml:lang="en-US" xmlns="http://www.w3.org/1999/xhtml">
  <!-- This file was converted to xhtml by Writer2xhtml ver. 1.6.1. See http://writer2latex.sourceforge.net for more info. -->
  <head profile="http://dublincore.org/documents/2008/08/04/dc-html/">
    <title></title>
    <meta charset="UTF-8" />
    <meta content="" name="description" />
    <meta content="" name="keywords" />
    <link href="http://purl.org/dc/elements/1.1/" rel="schema.DC" />
    <meta content="" name="DC.title" />
    <meta content="" name="DC.subject" />
    <meta content="" name="DC.description" />
    <meta content="" name="DC.creator" />
    <meta content="2020-09-29T14:27:00.154376202" name="DC.date" />
    <meta content="en" name="DC.language" />
    <link href="http://www.w3.org/StyleSheets/Core/Traditional" media="all" rel="stylesheet" type="text/css" />
  </head>
  <body dir="ltr">
    <p><b>How To Harden a server via OpenSCAP</b></p>
    <p class="Standard"> </p>
    <section id="TableofContents1">
      <h1 class="ContentsHeading">Table of Contents</h1>
      <ul style="list-style-type:none;margin:0;padding:0">
        <li>
          <p class="Contents1"><span class="SectionNumber"></span><a href="#toc0">Introduction</a></p>
        </li>
        <li>
          <p class="Contents2"><span class="SectionNumber"></span><a href="#toc1">WARNING!</a></p>
        </li>
        <li>
          <p class="Contents2"><span class="SectionNumber"></span><a href="#toc2">OS</a></p>
        </li>
        <li>
          <p class="Contents2"><span class="SectionNumber"></span><a href="#toc3">Definitions</a></p>
        </li>
        <li>
          <p class="Contents2"><span class="SectionNumber"></span><a href="#toc4">Security content in various formats</a></p>
        </li>
        <li>
          <p class="Contents3"><span class="SectionNumber"></span><a href="#toc5">Why?</a></p>
        </li>
        <li>
          <p class="Contents2"><span class="SectionNumber"></span><a href="#toc6">SCAP targets</a></p>
        </li>
        <li>
          <p class="Contents2"><span class="SectionNumber"></span><a href="#toc7">SCAP Components</a></p>
        </li>
        <li>
          <p class="Contents3"><span class="SectionNumber"></span><a href="#toc8">SCAP CONTENT</a></p>
        </li>
        <li>
          <p class="Contents3"><span class="SectionNumber"></span><a href="#toc9">SCAP SCANNERS</a></p>
        </li>
        <li>
          <p class="Contents3"><span class="SectionNumber"></span><a href="#toc10">Profile types</a></p>
        </li>
        <li>
          <p class="Contents3"><span class="SectionNumber"></span><a href="#toc11">ISM profiles</a></p>
        </li>
        <li>
          <p class="Contents3"><span class="SectionNumber"></span><a href="#toc12">Scanning remote machines</a></p>
        </li>
        <li>
          <p class="Contents3"><span class="SectionNumber"></span><a href="#toc13">Virtual Machine Alternatives</a></p>
        </li>
        <li>
          <p class="Contents4"><span class="SectionNumber"></span><a href="#toc14">VM</a></p>
        </li>
        <li>
          <p class="Contents4"><span class="SectionNumber"></span><a href="#toc15">Containers</a></p>
        </li>
        <li>
          <p class="Contents1"><span class="SectionNumber"></span><a href="#toc16">Installation</a></p>
        </li>
        <li>
          <p class="Contents2"><span class="SectionNumber"></span><a href="#toc17">Ansible server </a></p>
        </li>
        <li>
          <p class="Contents3"><span class="SectionNumber"></span><a href="#toc18">Yum</a></p>
        </li>
        <li>
          <p class="Contents3"><span class="SectionNumber"></span><a href="#toc19">Compliance As Code</a></p>
        </li>
        <li>
          <p class="Contents3"><span class="SectionNumber"></span><a href="#toc20">OpenSCAP ssh tool</a></p>
        </li>
        <li>
          <p class="Contents3"><span class="SectionNumber"></span><a href="#toc21">OpenSCAP workbench via source</a></p>
        </li>
        <li>
          <p class="Contents3"><span class="SectionNumber"></span><a href="#toc22">CIS Baseline </a></p>
        </li>
        <li>
          <p class="Contents2"><span class="SectionNumber"></span><a href="#toc23">Target server</a></p>
        </li>
        <li>
          <p class="Contents1"><span class="SectionNumber"></span><a href="#toc24">Build the latest SCAP content / playbooks</a></p>
        </li>
        <li>
          <p class="Contents1"><span class="SectionNumber"></span><a href="#toc25">Running OpenSCAP </a></p>
        </li>
        <li>
          <p class="Contents2"><span class="SectionNumber"></span><a href="#toc26">Setup passwordless ssh</a></p>
        </li>
        <li>
          <p class="Contents2"><span class="SectionNumber"></span><a href="#toc27">Scan</a></p>
        </li>
        <li>
          <p class="Contents3"><span class="SectionNumber"></span><a href="#toc28">Directly on target</a></p>
        </li>
        <li>
          <p class="Contents3"><span class="SectionNumber"></span><a href="#toc29">From Ansible server </a></p>
        </li>
        <li>
          <p class="Contents2"><span class="SectionNumber"></span><a href="#toc30">Creating a tailoring file</a></p>
        </li>
        <li>
          <p class="Contents2"><span class="SectionNumber"></span><a href="#toc31">Generate html report:</a></p>
        </li>
        <li>
          <p class="Contents1"><span class="SectionNumber"></span><a href="#toc32">Create hardening scripts</a></p>
        </li>
        <li>
          <p class="Contents2"><span class="SectionNumber"></span><a href="#toc33">Kickstart</a></p>
        </li>
        <li>
          <p class="Contents2"><span class="SectionNumber"></span><a href="#toc34">Ansible </a></p>
        </li>
        <li>
          <p class="Contents2"><span class="SectionNumber"></span><a href="#toc35">bash</a></p>
        </li>
        <li>
          <p class="Contents1"><span class="SectionNumber"></span><a href="#toc36">Using hardening scripts</a></p>
        </li>
        <li>
          <p class="Contents2"><span class="SectionNumber"></span><a href="#toc37">Kick-start</a></p>
        </li>
        <li>
          <p class="Contents2"><span class="SectionNumber"></span><a href="#toc38">Ansible</a></p>
        </li>
        <li>
          <p class="Contents2"><span class="SectionNumber"></span><a href="#toc39">bash</a></p>
        </li>
      </ul>
    </section>
    <p> </p>
    <h1 id="toc0"><a id="RefHeadingToc1050239467253"></a>Introduction</h1>
    <h2 id="toc1"><b>WARNING</b>!</h2>
    <p>Do not attempt to implement any of the settings in this guide without first testing them in a non-operational environment. There are elements of these guides that may make parts of, or the entire server inaccessible or inoperable!</p>
    <h2 id="toc2">OS</h2>
    <p>OpenSCAP is designed to be implemented on many Linuxes, including, <em>Red Hat Enterprise Linux (RHEL)</em>, CentOS, <em>Fedora</em>, <em>Ubuntu</em>, <em>Debian</em>, ... -- as well as products including – <em>Firefox</em>, <em>Chromium</em>, <em>JRE</em>, …</p>
    <p>The following document is tailored for implementation on RHEL. Please feel free to go to <a class="Internet20link" href="https://github.com/ComplianceAsCode/content">https://github.com/ComplianceAsCode/content</a> for more information</p>
    <h2 id="toc3"><a id="RefHeadingToc1054239467253"></a>Definitions</h2>
    <ul>
      <li>
        <p>OpenSCAP is sometimes referred to as OSCAP. It means Open Security Content Automation Protocol.</p>
      </li>
      <li>
        <p>Hardening, in this context, is the process of securing a system by reducing its <a class="Internet20link" href="https://en.wikipedia.org/wiki/Attack_surface">surface of vulnerability</a>, which is larger when a system performs more functions; in principle a single-function system is more secure than a multipurpose one. Reducing available ways of attack typically includes changing default passwords, the removal of unnecessary software, unnecessary usernames or logins, and the disabling or removal of unnecessary services.</p>
      </li>
    </ul>
    <p>There are various methods of hardening Linux systems. This may involve, among other measures, applying a patch to the kernel, closing open network ports; and setting up intrusion detection systems, firewall and other intrusion prevention systems.</p>
    <p> </p>
    <h2 id="toc4">Security content in various formats</h2>
    <div class="frameFrame" id="Frame1frame">
      <div style="text-align:center">
        <a href="https://github.com/ComplianceAsCode/content/blob/master/docs/readme_images/nist_logo.svg" target="_blank">
          <img alt="NIST logo" class="frameGraphics" id="Image1graphic" src="How To Harden a Server via OpenSCAP-img001.svg" style="width:239.0208px;height:67.008px" />
        </a>
      </div>
      <p class="Drawing">Drawing 1: National Institute of Standards and Technology</p>
    </div>
    <div class="frameFrame" id="Frame2frame">
      <div style="text-align:center">
        <a href="https://github.com/ComplianceAsCode/content/blob/master/docs/readme_images/ansible_logo.svg" target="_blank">
          <img alt="Ansible logo" class="frameGraphics" id="Image2graphic" src="How To Harden a Server via OpenSCAP-img002.svg" style="width:104.2752px;height:130.0128px" />
        </a>
      </div>
      <p class="Drawing">Drawing 2: Ansible Scripts</p>
    </div>
    <div class="frameFrame" id="Frame3frame">
      <div style="text-align:center">
        <a href="https://github.com/ComplianceAsCode/content/blob/master/docs/readme_images/bash_logo.png" target="_blank">
          <img alt="Bash logo" class="frameGraphics" id="Image3graphic" src="How To Harden a Server via OpenSCAP-img003.png" style="width:172.608px;height:172.608px" />
        </a>
      </div>
      <p class="Drawing">Drawing 3: Bash Scripts</p>
    </div>
    <p>  </p>
    <p><em>"SCAP content" </em>refers to documents in the <em>XCCDF</em>, <em>OVAL </em>and <em>Source DataStream </em>formats. These documents can be presented in different forms and by different organizations to meet their security automation and technical implementation needs. For general use, we recommend <em>Source DataStreams </em>because they contain all the data you need to evaluate and put machines into compliance. The datastreams are part of our release ZIP archives.</p>
    <p><em>"Ansible content" </em>refers to Ansible playbooks generated from security profiles. These can be used both in check-mode to evaluate compliance, as well as run-mode to put machines into compliance. We publish these on <em>Ansible Galaxy </em>as well as in release ZIP archives.</p>
    <p><em>"Bash fix files" </em>refers to <em>Bash </em>scripts generated from security profiles. These are meant to be run on machines to put them into compliance. We recommend using other formats but understand that for some deployment scenarios bash is the only option.</p>
    <h3 id="toc5"><a id="usercontentwhy"></a>Why?</h3>
    <p><em>We want multiple organizations to be able to efficiently develop and utilise security content. By taking advantage of the powerful build system, as much redundancy as possible is avoided.</em></p>
    <p><em>The build system combines the easy-to-edit YAML rule files with OVAL checks, Ansible task snippets, Bash fixes, and other files. Templating is provided at every step to avoid boilerplate. Security identifiers (CCE, NIST ID, STIG, ...) appear in all of our output formats but are all sourced from the YAML rule files.</em></p>
    <p><em>Depending on your organization's needs you may need to use a specific security content format. We let you choose.</em></p>
    <p><em><a href="https://github.com/ComplianceAsCode/content/blob/master/docs/readme_images/build_schema.svg" target="_blank"><img alt="Build system schema" class="frameGraphics" id="Image4graphic" src="How To Harden a Server via OpenSCAP-img004.svg" style="width:649.2096px;height:286.67517px" /></a></em></p>
    <hr />
    <p>We use an OpenControl-inspired YAML rule format for input. Write once and generate security content in XCCDF, Ansible, and others.</p>
    <h2 id="toc6">SCAP targets</h2>
    <p lang="zxx" xml:lang="zxx">Our security content can be used to scan bare-metal machines, virtual machines, virtual machine images (qcow2 and others), containers (including Docker), and container images.</p>
    <p lang="zxx" xml:lang="zxx">We use platform checks to detect whether we should or should not evaluate some of the rules. For example: separate partition checks make perfect sense on bare-metal machines but go against recommended practices on containers.</p>
    <h2 id="toc7"><a id="RefHeadingToc1056239467253"></a><a id="mntlscblock1011"></a>SCAP Components</h2>
    <p lang="zxx" xml:lang="zxx">SCAP content and SCAP scanners are the two main aspects of the Security Content Automation Protocol.</p>
    <h3 id="toc8"><a id="RefHeadingToc1058239467253"></a><a id="mntlscblock1014"></a>SCAP CONTENT</h3>
    <p><span lang="zxx" xml:lang="zxx">SCAP content modules are freely available content developed by the National Institute of Standards and Technologies (</span><a class="Internet20link" href="https://csrc.nist.gov/Projects" target="_blank"><span lang="zxx" xml:lang="zxx">NIST</span></a><span lang="zxx" xml:lang="zxx">) and its industry partners. The content modules are made from "secure" configurations that are agreed to by NIST and its SCAP partners.</span></p>
    <h3 id="toc9"><a id="RefHeadingToc1060239467253"></a><a id="mntlscblock1020"></a>SCAP SCANNERS</h3>
    <p><span lang="zxx" xml:lang="zxx">An SCAP scanner is a tool that compares a target computer or </span><a class="Internet20link" href="https://www.lifewire.com/what-is-a-web-application-3486637">a</a><span lang="zxx" xml:lang="zxx">pplication's configuration and/or patch level against that of the SCAP content baseline.</span></p>
    <p lang="zxx" xml:lang="zxx">The tool will note any deviations and produce a report. Some SCAP scanners also have the ability to correct the target computer and bring it into compliance with the standard baseline. </p>
    <h3 id="toc10"><a id="RefHeadingToc1062239467253"></a>Profile types</h3>
    <p>There are a few profiles types for RHEL and CentOS for hardening. Below are a list of those for RHEL 7 and 8:</p>
    <ol>
      <li>
        <p>No hardening – a.k.a. base installation</p>
      </li>
      <li>
        <p>RHEL 7</p>
      </li>
    </ol>
    <ul>
      <li>
        <p><a class="Internet20link" href="http://static.open-scap.org/ssg-guides/ssg-rhel7-guide-C2S.html"><span lang="zxx" xml:lang="zxx">C2S for Red Hat Enterprise Linux 7</span></a></p>
      </li>
      <li>
        <p><a class="Internet20link" href="http://static.open-scap.org/ssg-guides/ssg-rhel7-guide-cjis.html"><span lang="zxx" xml:lang="zxx">Criminal Justice Information Services (CJIS) Security Policy</span></a></p>
      </li>
      <li>
        <p><a class="Internet20link" href="http://static.open-scap.org/ssg-guides/ssg-rhel7-guide-nist-800-171-cui.html"><span lang="zxx" xml:lang="zxx">Unclassified Information in Non-federal Information Systems and Organizations (NIST 800-171)</span></a></p>
      </li>
      <li>
        <p><a class="Internet20link" href="http://static.open-scap.org/ssg-guides/ssg-rhel7-guide-pci-dss.html"><span lang="zxx" xml:lang="zxx">PCI-DSS v3.2.1 Control Baseline for Red Hat Enterprise Linux 7</span></a></p>
      </li>
      <li>
        <p><a class="Internet20link" href="http://static.open-scap.org/ssg-guides/ssg-rhel7-guide-rht-ccp.html"><span lang="zxx" xml:lang="zxx">Red Hat Corporate Profile for Certified Cloud Providers (RH CCP)</span></a></p>
      </li>
      <li>
        <p><a class="Internet20link" href="http://static.open-scap.org/ssg-guides/ssg-rhel7-guide-stig.html"><span lang="zxx" xml:lang="zxx">DISA STIG for Red Hat Enterprise Linux 7</span></a></p>
      </li>
      <li>
        <p><a class="Internet20link" href="http://static.open-scap.org/ssg-guides/ssg-rhel7-guide-rhelh-vpp.html"><span lang="zxx" xml:lang="zxx">VPP – Protection Profile for Virtualization v. 1.0 for Red Hat Enterprise Linux Hypervisor (RHELH)</span></a></p>
      </li>
      <li>
        <p><a class="Internet20link" href="http://static.open-scap.org/ssg-guides/ssg-rhel7-guide-standard.html"><span lang="zxx" xml:lang="zxx">Standard System Security Profile</span></a></p>
      </li>
      <li>
        <p><a class="Internet20link" href="http://static.open-scap.org/ssg-guides/ssg-rhel7-guide-ospp.html"><span lang="zxx" xml:lang="zxx">United States Government Configuration Baseline (USGCB / STIG) – DRAFT</span></a></p>
      </li>
    </ul>
    <ol>
      <li>
        <p>RHEL 8</p>
      </li>
    </ol>
    <ul>
      <li>
        <p><a class="Internet20link" href="http://static.open-scap.org/ssg-guides/ssg-rhel8-guide-cjis.html"><span lang="zxx" xml:lang="zxx">Criminal Justice Information Services (CJIS) Security Policy</span></a></p>
      </li>
      <li>
        <p><a class="Internet20link" href="http://static.open-scap.org/ssg-guides/ssg-rhel8-guide-hipaa.html"><span lang="zxx" xml:lang="zxx">Health Insurance Portability and Accountability Act (HIPAA)</span></a></p>
      </li>
      <li>
        <p><a class="Internet20link" href="http://static.open-scap.org/ssg-guides/ssg-rhel8-guide-cui.html"><span lang="zxx" xml:lang="zxx">Unclassified Information in Non-federal Information Systems and Organizations (NIST </span></a><a class="Internet20link" href="http://static.open-scap.org/ssg-guides/ssg-rhel8-guide-cui.html"><span lang="zxx" xml:lang="zxx">800-171)</span></a></p>
      </li>
      <li>
        <p><a class="Internet20link" href="http://static.open-scap.org/ssg-guides/ssg-rhel8-guide-pci-dss.html"><span lang="zxx" xml:lang="zxx">PCI-DSS v3.2.1 Control Baseline for Red Hat Enterprise Linux 8</span></a></p>
      </li>
      <li>
        <p><a class="Internet20link" href="http://static.open-scap.org/ssg-guides/ssg-rhel8-guide-rht-ccp.html"><span lang="zxx" xml:lang="zxx">Red Hat Corporate Profile for Certified Cloud Providers (RH CCP)</span></a></p>
      </li>
      <li>
        <p><a class="Internet20link" href="http://static.open-scap.org/ssg-guides/ssg-rhel8-guide-standard.html"><span lang="zxx" xml:lang="zxx">Standard System Security Profile for Red Hat Enterprise Linux 8</span></a></p>
      </li>
      <li>
        <p><a class="Internet20link" href="http://static.open-scap.org/ssg-guides/ssg-rhel8-guide-ospp.html"><span lang="zxx" xml:lang="zxx">Protection Profile for General Purpose Operating Systems</span></a></p>
      </li>
      <li>
        <p><a class="Internet20link" href="http://static.open-scap.org/ssg-guides/ssg-rhel8-guide-ism_o.html"><span lang="zxx" xml:lang="zxx">Australian Cyber Security Centre (ACSC) Information Security Manual (ISM) Official</span></a></p>
      </li>
    </ul>
    <p lang="zxx" xml:lang="zxx"><b>NOTE: </b>These are not in any order of hardening strength, but should be examined on a case by case basis, to see whether they are suited to &lt;Customer&gt;</p>
    <h3 id="toc11"><a id="RefHeadingToc1064239467253"></a>ISM profiles</h3>
    <p>At the time of writing, only ISM_O (ACSC Information Security Manual (ISM) Official) profile is the only ISM profile included in the standard OpenSCAP repositories. </p>
    <p>There are plans to have a locally produced ISM profiles. They will fall into one of the three following categories:</p>
    <ul>
      <li>
        <p>ISM_P for the PROTECTED systems</p>
      </li>
      <li>
        <p>ISM_S for the SECRET systems</p>
      </li>
      <li>
        <p>ISM_TS for the TOP SECRET systems</p>
      </li>
    </ul>
    <p>These profiles should be considered a work in progress and may remain unsupported by Red Hat or the ComplianceAsCode community.</p>
    <p><b>NOTES:</b></p>
    <ol>
      <li>
        <p>Each of the ISM protocols, above utilise a fourth profile, ISM_O, which contains all of the rules that are common to all the three above profiles</p>
      </li>
      <li>
        <p>The higher classification profile DO NOT include the lesser classification profiles. i.e. ISM_TS does not utilise ISM_S, which does not utilise ISM_P</p>
      </li>
    </ol>
    <h3 id="toc12"><a id="RefHeadingToc1072239467253"></a>Scanning remote machines</h3>
    <p>The <code><b>oscap-ssh</b> </code>is a simple tool for scanning remote machines with OpenSCAP over network and collecting results.</p>
    <p>The tool uses SSH connection to copy the SCAP content to a remote machine, then it runs an evaluation of the target system and downloads the results back. <i>The remote machine needs to have OpenSCAP installed.</i></p>
    <p>The tool can evaluate source DataStreams and OVAL files. Usage of the tool mimics usage and options of <code>oscap </code>tool.</p>
    <pre>It is recommended to use this remote operations tool so that all the results and reports are centralised.</pre>
    <h3 id="toc13"><a id="RefHeadingToc1074239467253"></a>Virtual Machine Alternatives</h3>
    <h4 id="toc14"><a id="RefHeadingToc1076239467253"></a>VM</h4>
    <p>OpenSCAP provides a simple tool to evaluate virtual machines called <code><b>oscap-vm</b></code>.</p>
    <p>Usage of the tool mimics usage and options of <code>oscap </code>tool.</p>
    <p> </p>
    <p><b>NB: The tool can scan given virtual machine directly from the virtualisation host. e.g. RHEL host with VM via KVM.</b></p>
    <h4 id="toc15"><a id="RefHeadingToc1078239467253"></a>Containers</h4>
    <p>OpenSCAP provides a simple tool to evaluate virtual machines called <code><b>oscap-docker</b></code>, this utility also uses offline scanning, so it doesn’t install anything in the guest, doesn’t require OpenSCAP installed in the guest and it doesn’t create or change anything in the guest’s filesystem. Usage of the tool mimics usage and options of <code>oscap </code>tool.</p>
    <p> </p>
    <p><b>NOTE: The filesystem of the container is mounted to a directory on the host. The mounted filesystem is read-only. OpenSCAP then assess the container from the host. Therefore no agent is installed in the container and container is not touched or changed in any way.</b></p>
    <h1 id="toc16"><a id="RefHeadingToc1080239467253"></a>Installation</h1>
    <h2 id="toc17"><a id="RefHeadingToc1082239467253"></a>Ansible server </h2>
    <p>- if not done via the kickstart of this server</p>
    <h3 id="toc18"><a id="RefHeadingToc1084239467253"></a>Yum</h3>
    <ul>
      <li>
        <p>ssh ${ansible_server}</p>
      </li>
      <li>
        <p>sudo yum install -y ansible git openscap scap-security-guide scap-workbench</p>
      </li>
    </ul>
    <h3 id="toc19"><a id="RefHeadingToc1086239467253"></a>Compliance As Code</h3>
    <ul>
      <li>
        <p>cd /${PATH_TO_OPENSCAP_CONTENT} #e.g. /home/ahamilto/Ansible/</p>
      </li>
      <li>
        <p>git clone https://github.com/ComplianceAsCode/content.git</p>
      </li>
    </ul>
    <p>OR/</p>
    <ul>
      <li>
        <p>cd content; git pull</p>
      </li>
    </ul>
    <h3 id="toc20"><a id="RefHeadingToc1088239467253"></a>OpenSCAP ssh tool</h3>
    <ul>
      <li>
        <p>cd /usr/share/openscap</p>
      </li>
      <li>
        <p>git clone https://github.com/mpreisler/oscap-ssh.git</p>
      </li>
    </ul>
    <p>OR/</p>
    <ul>
      <li>
        <p>cd /usr/share/openscap/; git pull</p>
      </li>
    </ul>
    <h3 id="toc21"><a id="RefHeadingToc1090239467253"></a>OpenSCAP workbench via source</h3>
    <p>The following builds the source code, rather than using yum:</p>
    <ul>
      <li>
        <p>wget -O ${PATH_TO_OPENSCAP_CONTENT}/OpenSCAP_WorkBench/ https://github.com/OpenSCAP/scap-workbench/releases</p>
      </li>
      <li>
        <p>cd ${PATH_TO_OPENSCAP_CONTENT}/OpenSCAP_WorkBench/</p>
      </li>
      <li>
        <p>tar jxf scap-workbench-${ver}.tar.bz2</p>
      </li>
      <li>
        <p>cd scap-workbench-${ver}; less README.md =&gt;</p>
      </li>
      <li>
        <p>mkdir build; cd build; \</p>
      </li>
      <li>
        <p>cmake -DOPENSCAP_LIBRARIES:PATH=/usr/lib64/libopenscap.so \</p>
      </li>
    </ul>
    <p>-DOPENSCAP_INCLUDE_DIRS:PATH=/usr/include/openscap/ \</p>
    <p>-DOPENSCAP_VERSION:STRING="1.2.1" ../</p>
    <ul>
      <li>
        <p>make install</p>
      </li>
    </ul>
    <h3 id="toc22"><a id="RefHeadingToc1092239467253"></a>CIS Baseline </h3>
    <ul>
      <li>
        <p>cd /${PATH_TO_OPENSCAP_CONTENT}</p>
      </li>
      <li>
        <p>git clone <a class="Internet20link" href="https://github.com/ggatward/Ansible-RHEL8-CIS-Benchmarks.git">https://github.com/ggatward/Ansible-RHEL8-CIS-Benchmarks.git</a></p>
      </li>
    </ul>
    <p><b>NOTES: </b></p>
    <ol>
      <li>
        <p>Role for RHEL: see <a class="Internet20link" href="https://martin.preisler.me/2013/11/xccdf-tailoring/">https://martin.preisler.me/2013/11/xccdf-tailoring/</a></p>
      </li>
    </ol>
    <h2 id="toc23"><a id="RefHeadingToc1094239467253"></a>Target server</h2>
    <p>- if not done via the kickstart</p>
    <ul>
      <li>
        <p>ssh target_server</p>
      </li>
      <li>
        <p>sudo yum install -y git openscap scap-security-guide</p>
      </li>
      <li>
        <p>cd /${PATH_TO_OPENSCAP_CONTENT}</p>
      </li>
    </ul>
    <p>[e.g.] /usr/share/openscap/</p>
    <ul>
      <li>
        <p>git clone https://github.com/ComplianceAsCode/content.git </p>
      </li>
    </ul>
    <h1 id="toc24"><a id="RefHeadingToc1096239467253"></a>Build the latest SCAP content / playbooks</h1>
    <p>- directly from the project</p>
    <ul>
      <li>
        <p>cd /usr/share/scap-security-guide</p>
      </li>
      <li>
        <p>mkdir build</p>
      </li>
      <li>
        <p>podman run -e SCAP_PRODUCT='rhel8' -v ./build:/build:z \</p>
      </li>
    </ul>
    <p>quay.io/smileyfritz/cacfactory:latest</p>
    <p>Error: relabel failed "/usr/share/scap-security-guide/build": relabeling content in /usr is not allowed =&gt; Needs investigating</p>
    <p><b>NOTE: </b>The latest SCAP datastream files and Ansible playbooks will then be available in the ‘build’ directory</p>
    <h1 id="toc25"><a id="RefHeadingToc1098239467253"></a>Running OpenSCAP </h1>
    <p>- over system =&gt; Produce hardening</p>
    <h2 id="toc26"><a id="RefHeadingToc1100239467253"></a>Setup passwordless ssh</h2>
    <ul>
      <li>
        <p>[Only once on server] ssh-keygen -t rsa</p>
      </li>
      <li>
        <p>[On server] ssh-copy-id username@remotemachine</p>
      </li>
      <li>
        <p>[Possibly on client] chmod 755 ~/.ssh/authorized_keys</p>
      </li>
      <li>
        <p>[Possibly on client] chmod 700 ~/.ssh/id_*</p>
      </li>
    </ul>
    <h2 id="toc27"><a id="RefHeadingToc1102239467253"></a>Scan</h2>
    <p><b>NOTE: </b>OVAL XML, does not offer remediations fixes like is found in XCCDF XML</p>
    <h3 id="toc28"><a id="RefHeadingToc1104239467253"></a>Directly on target</h3>
    <p>- MUST have OpenSCAP installed [via `sudo yum install -y openscap scap-security-guide] </p>
    <ul>
      <li>
        <p>ssh ${target_server}</p>
      </li>
      <li>
        <p>cd /${PATH_TO_RESULTS_FILES} </p>
      </li>
    </ul>
    <p>e.g. /var/tmp/openscap_results</p>
    <ul>
      <li>
        <p>oscap xccdf eval --results goldsvr_${ServerType}_${HardeningType}.xml \</p>
      </li>
    </ul>
    <p>--profile ${PROFILE} \</p>
    <p>--fetch-remote-resources \</p>
    <p>${ContentXML} </p>
    <h3 id="toc29"><a id="RefHeadingToc1106239467253"></a>From Ansible server </h3>
    <p>- This is the preferred method so that all the results and reports are centralised.</p>
    <p>- The remote machine needs to have OpenSCAP installed</p>
    <p>[via `sudo yum install -y openscap scap-security-guide]</p>
    <ul>
      <li>
        <p>ssh ${ansible_server}</p>
      </li>
      <li>
        <p>cd <i>${PATH_TO_RESULTS_FILES}</i>/${TargetHostFQDN} </p>
      </li>
    </ul>
    <p>#e.g. /var/tmp/openscap_results/${TargetHostFQDN}</p>
    <ul>
      <li>
        <p>oscap-ssh ${SID}@${TargetHostFQDN} 22 xccdf eval \</p>
      </li>
    </ul>
    <p>--results goldsvr_${ServerType}_${HardeningType}.xml \</p>
    <p>--results-arf goldsvr_${ServerType}_${HardeningType}-arf.xml \</p>
    <p>--report goldsvr_${ServerType}_${HardeningType}.html \</p>
    <p>--fetch-remote-resources \</p>
    <p>--profile xccdf_org.ssgproject.content_profile_e8 \</p>
    <p>[--tailoring-file /usr/share/openscap/schemas/xccdf/${TailoringFile}.xml \]</p>
    <p>/usr/share/xml/scap/ssg/content/${ContentXML} </p>
    <p><b>NOTES:</b> For the above commands;</p>
    <ol>
      <li>
        <p>${ContentXML} available are:</p>
      </li>
    </ol>
    <p>[obtained by `ls /usr/share/xml/scap/ssg/content/`]:</p>
    <p>ssg-firefox-cpe-dictionary.xml</p>
    <p>ssg-firefox-cpe-oval.xml</p>
    <p>ssg-firefox-ds-1.2.xml</p>
    <p>ssg-firefox-ds.xml</p>
    <p>ssg-firefox-ocil.xml</p>
    <p>ssg-firefox-oval.xml</p>
    <p>ssg-firefox-xccdf.xml</p>
    <p>ssg-jre-cpe-dictionary.xml</p>
    <p>ssg-jre-cpe-oval.xml</p>
    <p>ssg-jre-ds-1.2.xml</p>
    <p>ssg-jre-ds.xml</p>
    <p>ssg-jre-ocil.xml</p>
    <p>ssg-jre-oval.xml</p>
    <p>ssg-jre-xccdf.xml</p>
    <p>ssg-rhel6-cpe-dictionary.xml</p>
    <p>ssg-rhel6-cpe-oval.xml</p>
    <p>ssg-rhel6-ds-1.2.xml</p>
    <p>ssg-rhel6-ds.xml</p>
    <p>ssg-rhel6-ocil.xml</p>
    <p>ssg-rhel6-oval.xml</p>
    <p>ssg-rhel6-xccdf.xml</p>
    <p>ssg-rhel7-cpe-dictionary.xml</p>
    <p>ssg-rhel7-cpe-oval.xml</p>
    <p>ssg-rhel7-ds-1.2.xml</p>
    <p>ssg-rhel7-ds.xml</p>
    <p>ssg-rhel7-ocil.xml</p>
    <p>ssg-rhel7-oval.xml</p>
    <p>ssg-rhel7-xccdf.xml</p>
    <p>ssg-rhel8-cpe-dictionary.xml</p>
    <p>ssg-rhel8-cpe-oval.xml</p>
    <p>ssg-rhel8-ds-1.2.xml</p>
    <p>ssg-rhel8-ds.xml</p>
    <p>ssg-rhel8-ocil.xml</p>
    <p>ssg-rhel8-oval.xml</p>
    <p>ssg-rhel8-xccdf.xml</p>
    <ol>
      <li>
        <p>${Profile}  [Id’s] available are [obtained by `oscap info "/tmp/tmp.??????????/input.xml"`]:</p>
      </li>
    </ol>
    <p>...</p>
    <p>Title: Protection Profile for General Purpose Operating Systems</p>
    <p>Id: xccdf_org.ssgproject.content_profile_ospp</p>
    <p>Title: PCI-DSS v3.2.1 Control Baseline for Red Hat Enterprise Linux 8</p>
    <p>Id: xccdf_org.ssgproject.content_profile_pci-dss</p>
    <p>Title: [DRAFT] DISA STIG for Red Hat Enterprise Linux 8</p>
    <p>Id: xccdf_org.ssgproject.content_profile_stig</p>
    <p>Title: Australian Cyber Security Centre (ACSC) Essential Eight</p>
    <p>Id: xccdf_org.ssgproject.content_profile_e8</p>
    <p>... </p>
    <ol>
      <li>
        <p>${TailoringFile}.xml is a customisation of a specific type of profile </p>
      </li>
    </ol>
    <p>- See <a class="Internet20link" href="https://martin.preisler.me/2013/11/xccdf-tailoring/">How To Tailor a Profile by Martin Preisler</a></p>
    <p><b>NB:</b> ${SID} <i>MUST</i> have sudo access</p>
    <h2 id="toc30"><a id="RefHeadingToc1108239467253"></a>Creating a tailoring file</h2>
    <p>- This is not normally needed, but if you need to customise your hardening, it can be done here.</p>
    <p>- a.k.a. Standard/Gold file</p>
    <ul>
      <li>
        <p>ssh -X ${ansible_server}</p>
      </li>
      <li>
        <p>/usr/local/bin/scap-workbench</p>
      </li>
      <li>
        <p>Open goldsvr_${ServerType}_${HardeningType}.xml [e.g. goldsvr_CIS.xml]</p>
      </li>
      <li>
        <p>Click "Customize" -&gt; this will warn that you are creating a "New Profile" but in fact you are about to create a tailoring file.</p>
      </li>
      <li>
        <p>Enter the name for the tailoring file ${TailoringFile}.xml</p>
      </li>
      <li>
        <p>(De)Select the rules you wish to (not) execute</p>
      </li>
      <li>
        <p>Press "OK"</p>
      </li>
    </ul>
    <p> </p>
    <p><b>NOTES:</b></p>
    <ol>
      <li>
        <p>The auditd hardening assumes that [for ASD] ace_audit is installed</p>
      </li>
      <li>
        <p>See <a class="Internet20link" href="https://github.com/OpenSCAP/scap-workbench/releases/download/1.1.0/user_manual.html">https://github.com/OpenSCAP/scap-workbench/releases/download/1.1.0/user_manual.html</a></p>
      </li>
      <li>
        <p>There is NO interim save</p>
      </li>
    </ol>
    <h2 id="toc31"><a id="RefHeadingToc1112239467253"></a>Generate html report:</h2>
    <p>- This is only to be used if the html report is not already generated in execution of the <a class="Internet20link">Scan</a> section above.</p>
    <ul>
      <li>
        <p>ssh ${ansible_server}</p>
      </li>
      <li>
        <p>cd /${PATH_TO_RESULTS_FILES} #e.g. /var/tmp/openscap_results</p>
      </li>
      <li>
        <p>sudo oscap xccdf generate report --output goldsvr_${ServerType}_${HardeningType}.html \</p>
      </li>
    </ul>
    <p>goldsvr_${ServerType}_${HardeningType}.xml</p>
    <h1 id="toc32"><a id="RefHeadingToc1114239467253"></a>Create hardening scripts</h1>
    <p><b>WARNING: It is advisable to examine ${TargetHost}.xml before the following are run, with a view of removing unwanted elements!  There may be resultant procedures of these scripts that may make parts of, or the entire server inaccessible or inoperable! Ansible and bash scripts do not have <i>automatic</i> rollbacks in the case of a</b></p>
    <h2 id="toc33"><a id="RefHeadingToc1116239467253"></a>Kickstart</h2>
    <ul>
      <li>
        <p>Change kickstart [*.cfg] template to include</p>
      </li>
    </ul>
    <p>e.g.</p>
    <p>...</p>
    <p># Create primary system partitions (required for installs)</p>
    <p>...</p>
    <p># Harden installation with Essential Eight profile</p>
    <p># For more details and configuration options see</p>
    <p># <a class="Internet20link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/performing_an_advanced_rhel_installation/index">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/performing_an_advanced_rhel_installation/index</a></p>
    <p># addon-org_fedora_oscap_kickstart-commands-for-addons-supplied-with-the-rhel-installation-program</p>
    <p><b>%addon org_fedora_oscap</b></p>
    <p><b>content-type = scap-security-guide</b></p>
    <p><b>profile = xccdf_org.ssgproject.content_profile_e8</b></p>
    <p><b>%end</b></p>
    <p> </p>
    <p># Packages selection (%packages section is required)</p>
    <p>%packages</p>
    <p>…</p>
    <p><b>NOTE: </b>A list of possible oscap kick-start profiles are via: </p>
    <p>`grep content_profile /usr/share/scap-security-guide/kickstart/*`</p>
    <h2 id="toc34"><a id="RefHeadingToc1190239467253"></a>Ansible </h2>
    <ul>
      <li>
        <p>ssh ${ansible_server}</p>
      </li>
      <li>
        <p>cd /${PATH_TO_RESULTS_FILES} #e.g. /var/tmp/openscap_results</p>
      </li>
      <li>
        <p>sudo oscap xccdf generate fix --profile xccdf_org.ssgproject.content_profile_e8 \</p>
      </li>
    </ul>
    <p>--fetch-remote-resources \</p>
    <p>[--tailoring-file /usr/share/openscap/schemas/xccdf/${TailoringFile}.xml \] \</p>
    <p>--fix-type<b> </b><b>ansible</b> ${TargetHost}.xml &gt; ${TargetHost}.<b>yml</b></p>
    <p><b>NOTES:</b></p>
    <ol>
      <li>
        <p>There is a bug in the oscap, so “--output ${TargetHost}.bash” doesn’t produce any output, so need “&gt; ${TargetHost}.yml” at end.</p>
      </li>
      <li>
        <p>${Profile} [Id’s] available are [obtained by `oscap info "/tmp/tmp.??????????/input.xml"`]:</p>
      </li>
    </ol>
    <p>...</p>
    <p>Title: Protection Profile for General Purpose Operating Systems</p>
    <p>Id: xccdf_org.ssgproject.content_profile_ospp</p>
    <p>Title: PCI-DSS v3.2.1 Control Baseline for Red Hat Enterprise Linux 8</p>
    <p>Id: xccdf_org.ssgproject.content_profile_pci-dss</p>
    <p>Title: [DRAFT] DISA STIG for Red Hat Enterprise Linux 8</p>
    <p>Id: xccdf_org.ssgproject.content_profile_stig</p>
    <p>Title: Australian Cyber Security Centre (ACSC) Essential Eight</p>
    <p>Id: xccdf_org.ssgproject.content_profile_e8</p>
    <p>... </p>
    <h2 id="toc35"><a id="RefHeadingToc1192239467253"></a>bash</h2>
    <ul>
      <li>
        <p>ssh ${ansible_server}</p>
      </li>
      <li>
        <p>cd /${PATH_TO_RESULTS_FILES} #e.g. /var/tmp/openscap_results</p>
      </li>
      <li>
        <p>sudo oscap xccdf generate fix --profile xccdf_org.ssgproject.content_profile_e8 \</p>
      </li>
    </ul>
    <p>--fetch-remote-resources \</p>
    <p>[--tailoring-file /usr/share/openscap/schemas/xccdf/${TailoringFile}.xml \] \</p>
    <p>--fix-type<b> bash</b> ${TargetHost}.xml &gt; ${TargetHost}.<b>bash</b></p>
    <p><b>NOTE</b><b>S</b><b>:</b></p>
    <ol>
      <li>
        <p>There is a bug in the oscap, so “--output ${TargetHost}.bash” doesn’t produce any output, so need “&gt; ${TargetHost}.bash” at end.</p>
      </li>
      <li>
        <p>${Profile} [Id’s] available are [obtained by `oscap info "/tmp/tmp.??????????/input.xml"`]:</p>
      </li>
    </ol>
    <p>...</p>
    <p>Title: Protection Profile for General Purpose Operating Systems</p>
    <p>Id: xccdf_org.ssgproject.content_profile_ospp</p>
    <p>Title: PCI-DSS v3.2.1 Control Baseline for Red Hat Enterprise Linux 8</p>
    <p>Id: xccdf_org.ssgproject.content_profile_pci-dss</p>
    <p>Title: [DRAFT] DISA STIG for Red Hat Enterprise Linux 8</p>
    <p>Id: xccdf_org.ssgproject.content_profile_stig</p>
    <p>Title: Australian Cyber Security Centre (ACSC) Essential Eight</p>
    <p>Id: xccdf_org.ssgproject.content_profile_e8</p>
    <p>... </p>
    <h1 id="toc36"><a id="RefHeadingToc1194239467253"></a>Using hardening scripts</h1>
    <p><b>WARNING: Take a snapshot / backup of the server prior to hardening in case a rollback is necessary. Ansible and bash scripts do not have <i>automatic</i> rollbacks in the case of a failure!</b></p>
    <h2 id="toc37"><a id="RefHeadingToc11162394672531"></a>Kick-start</h2>
    <ul>
      <li>
        <p>Kick-start the server</p>
      </li>
    </ul>
    <p><b>NOTE</b><b>: </b>This only provides a “one off” hardening. It is recommended that the server is regularly checked via Ansible or bash!</p>
    <h2 id="toc38"><a id="RefHeadingToc1118239467253"></a>Ansible</h2>
    <ul>
      <li>
        <p>ssh ${ansible_server}</p>
      </li>
      <li>
        <p>PATH_TO_DESIRED_SCRIPT = /usr/share/scap-security-guide/ansible/</p>
      </li>
    </ul>
    <p>OR/</p>
    <ul>
      <li>
        <p>PATH_TO_DESIRED_SCRIPT = <i>${PATH_TO_RESULTS_FILES}</i></p>
      </li>
    </ul>
    <p>OR/</p>
    <ul>
      <li>
        <p>PATH_TO_DESIRED_SCRIPT = <i>${PATH_TO_GOLD_RULE}</i></p>
      </li>
    </ul>
    <p> </p>
    <ul>
      <li>
        <p>ansible-playbook -i "${TargetHost1},...,${TargetHostn}," -bkK \</p>
      </li>
    </ul>
    <p>/${PATH_TO_DESIRED_SCRIPT}/${OSCAP_SCRIPT}.yml</p>
    <p><b>NB</b><b>s</b><b>:</b></p>
    <ol>
      <li>The Ansible <b><i>SHOULD</i></b> be run regularly to ensure that the server is still compliant!</li>
      <li>
        <p><b><i>MUST</i></b>:</p>
      </li>
    </ol>
    <ul>
      <li><ul><li><p>put the "," [incl. The parentheses] after the last hostname in the above command</p></li><li><p>ssh to ALL ${TargetHost}s prior to running Ansible to establish entries in known_hosts</p></li></ul></li>
    </ul>
    <p><b>NOTE: </b>Each of the Ansible Playbooks contain instructions on how to deploy them. In the top comments.</p>
    <h2 id="toc39"><a id="RefHeadingToc1120239467253"></a>bash</h2>
    <ul>
      <li>
        <p>PATH_TO_DESIRED_SCRIPT = /usr/share/scap-security-guide/ansible/</p>
      </li>
      <li>
        <p>OR/</p>
      </li>
      <li>
        <p>PATH_TO_DESIRED_SCRIPT = <i>${PATH_TO_RESULTS_FILES}</i></p>
      </li>
      <li>
        <p>OR/</p>
      </li>
      <li>
        <p>PATH_TO_DESIRED_SCRIPT = <i>${PATH_TO_GOLD_RULE}</i></p>
      </li>
    </ul>
    <p> </p>
    <ul>
      <li>
        <p>bash -x ${PATH_TO_DESIRED_SCRIPT}/${OSCAP_SCRIPT}</p>
      </li>
    </ul>
    <p><b>NOTE: </b>Each of the bash scripts contain instructions on how to deploy them. In the top comments.</p>
  </body>
</html>
